<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Quête du Code Ancestral | Bragi</title>
    <link rel="icon" type="image/png" href="../../favicon.png">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Spectral:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <!-- Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#ecc94b', // Amber/Gold
                        secondary: '#4f46e5', // Magic Indigo
                        accent: '#805ad5', // Purple
                        background: {
                            light: '#fdfbf7',
                            dark: '#1a0f2e',
                        },
                        surface: {
                            light: '#f4ece1',
                            dark: '#2d1b4d',
                            highlight: '#3d2b5d',
                        }
                    },
                    fontFamily: {
                        heading: ['Cinzel', 'serif'],
                        body: ['Spectral', 'serif'],
                    }
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer base {
            body {
                background-color: #1a0f2e;
                color: #e2e8f0;
                min-height: 100vh;
                display: flex;
                flex-direction: column;
                font-family: 'Spectral', serif;
            }
            body::selection {
                background-color: rgba(236, 201, 75, 0.3);
                color: #ecc94b;
            }
            h1, h2, h3, h4 {
                font-family: 'Cinzel', serif;
                text-transform: uppercase;
                letter-spacing: 0.05em;
            }
        }

        @layer components {
            .parchment-card {
                background-color: #f4e8d0;
                color: #2c1810;
                border-width: 2px;
                border-color: #d4af37;
                box-shadow: 0 0 30px rgba(236, 201, 75, 0.1);
                position: relative;
                overflow: hidden;
                transition-property: all;
                transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
                transition-duration: 300ms;
            }

            .choice-btn {
                transition-property: all;
                transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
                transition-duration: 300ms;
                position: relative;
                overflow: hidden;
                background-color: rgba(255, 255, 255, 0.05);
                border: 1px solid rgba(236, 201, 75, 0.2);
                padding: 1.5rem;
                border-radius: 0.5rem;
                text-align: left;
            }

            .choice-btn:hover {
                background-color: rgba(236, 201, 75, 0.1);
                border-color: rgba(236, 201, 75, 0.5);
                box-shadow: 0 0 15px rgba(236, 201, 75, 0.2);
            }

            .choice-btn.selected {
                background-color: rgba(236, 201, 75, 0.2);
                border-color: #ecc94b;
                box-shadow: 0 0 20px rgba(236, 201, 75, 0.3);
            }
            
            .magical-divider {
                height: 1px;
                width: 100%;
                background: linear-gradient(to right, transparent, rgba(236, 201, 75, 0.4), transparent);
                margin-top: 2rem;
                margin-bottom: 2rem;
            }
        }

        .grimoire-texture {
            background-image: url("https://www.transparenttextures.com/patterns/old-map.png");
            opacity: 0.05;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 100;
        }
    </style>

    <script src="../../js/security.js"></script>
    <script src="../../js/storyEngine.js"></script>
    <script src="../../js/fantasy/medieval/quest.js" defer></script>
</head>

<body>
    <div class="grimoire-texture"></div>

    <!-- Header -->
    <header class="sticky top-0 z-50 bg-background-dark/80 backdrop-blur-md border-b border-primary/10">
        <div class="max-w-7xl mx-auto px-4 h-20 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <div
                    class="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center border border-primary/30">
                    <span class="material-symbols-outlined text-primary text-2xl">auto_stories</span>
                </div>
                <div>
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-white to-primary bg-clip-text text-transparent">
                        QUÊTE DU CODE</h1>
                    <p class="text-[10px] text-primary/60 font-serif tracking-[0.3em] uppercase -mt-1 italic">Le
                        Manuscrit du Destin</p>
                </div>
            </div>
            <nav class="hidden md:flex items-center gap-8 text-sm font-heading tracking-widest">
                <a href="../medieval.html" class="flex items-center gap-2 hover:text-primary transition-colors group">
                    <span
                        class="material-symbols-outlined text-lg group-hover:-translate-x-1 transition-transform">castle</span>
                    CANTINE
                </a>
                <div class="h-4 w-[1px] bg-primary/20"></div>
                <div class="flex items-center gap-2 text-primary/80">
                    <span class="material-symbols-outlined text-lg animate-pulse">magic_button</span>
                    FLUX DE MANA ACTIF
                </div>
            </nav>
        </div>
    </header>

    <main class="flex-grow max-w-7xl mx-auto w-full px-4 py-12 relative">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 items-start">

            <!-- Left Column: Story Content (8/12) -->
            <div class="lg:col-span-8 space-y-16 pb-32" id="story">

                <!-- Hero Image Area -->
                <div class="relative group rounded-2xl overflow-hidden border-2 border-primary/20 shadow-2xl">
                    <img id="hero-image" src="../../img/cards/stories/quest.png" alt="Quest Legend"
                        class="w-full aspect-video object-cover transition-transform duration-1000 group-hover:scale-105">
                    <div
                        class="absolute inset-0 bg-gradient-to-t from-background-dark via-background-dark/20 to-transparent">
                    </div>
                    <div class="absolute bottom-10 left-10 right-10">
                        <div class="flex items-center gap-2 text-primary text-sm mb-3">
                            <span class="material-symbols-outlined text-lg">history_edu</span>
                            ANNOTATION DU MAGE
                        </div>
                        <h2 class="text-4xl lg:text-5xl font-bold text-white mb-4 leading-none">LA QUÊTE DU CODE
                            ANCESTRAL</h2>
                        <p class="text-primary/80 italic text-xl border-l-2 border-primary/40 pl-6 leading-relaxed">
                            &ldquo;Celui qui maîtrise le Legacy, maîtrise le Monde.&rdquo;
                        </p>
                    </div>
                </div>

                <!-- Story Sections -->

                <!-- 1. ENTREE -->
                <div class="section space-y-8">
                    <div class="flex items-center gap-4">
                        <div
                            class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/30">
                            <span class="text-primary font-heading">I</span>
                        </div>
                        <h3 class="text-2xl text-primary tracking-widest">L'ENTRÉE DU DONJON "LEGACY"</h3>
                    </div>
                    <div class="prose prose-invert prose-amber max-w-none text-xl leading-relaxed italic">
                        <p>Vous vous tenez devant une porte massive couverte de toiles d'araignée. Une inscription
                            gravée dit : <span class="text-primary underline">"Dernière mise à jour : 2003"</span>.</p>
                        <p>Un vieux parchemin (<code>README.txt</code>) est cloué dessus.</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 choice-container">
                        <button class="choice-btn choice" data-mana="-5" data-xp="+5" data-karma="+5"
                            onclick="applyChoice(this)">
                            <div class="text-primary/60 text-[10px] uppercase mb-2">Prudence</div>
                            <p class="text-lg font-bold">Lire attentivement le parchemin (Documentation).</p>
                        </button>
                        <button class="choice-btn choice" data-mana="0" data-xp="+0" data-karma="-5"
                            onclick="applyChoice(this)">
                            <div class="text-red-400/60 text-[10px] uppercase mb-2">Impatience</div>
                            <p class="text-lg font-bold">Enfoncer la porte en hurlant "DEPLOY TO PROD!".</p>
                        </button>
                    </div>
                    <div class="magical-divider"></div>
                </div>

                <!-- 2. GOBELIN -->
                <div class="section space-y-8">
                    <div class="flex items-center gap-4">
                        <div
                            class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/30">
                            <span class="text-primary font-heading">II</span>
                        </div>
                        <h3 class="text-2xl text-primary tracking-widest">LE GOBELIN STAGIAIRE</h3>
                    </div>
                    <div class="prose prose-invert prose-amber max-w-none text-xl leading-relaxed italic">
                        <p>Un petit gobelin nerveux bloque le couloir. Il tient une Pull Request tremblante.</p>
                        <p class="text-primary/80">&ldquo; S'il vous plaît, messire, can I merge ? J'ai peur de casser
                            la prod. &rdquo;</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 choice-container">
                        <button class="choice-btn choice" data-mana="-5" data-xp="+10" data-karma="+10"
                            onclick="applyChoice(this)">
                            <p class="text-lg font-bold">Faire une Code Review bienveillante et corriger ses erreurs.
                            </p>
                        </button>
                        <button class="choice-btn choice" data-mana="0" data-xp="+0" data-karma="-10"
                            onclick="applyChoice(this)">
                            <p class="text-lg font-bold">Lui dire "LGTM" sans regarder et courir.</p>
                        </button>
                    </div>
                    <div class="magical-divider"></div>
                </div>

                <!-- 3. PONT -->
                <div class="section space-y-8">
                    <div class="flex items-center gap-4">
                        <div
                            class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/30">
                            <span class="text-primary font-heading">III</span>
                        </div>
                        <h3 class="text-2xl text-primary tracking-widest">LE PONT DES TESTS</h3>
                    </div>
                    <div class="prose prose-invert prose-amber max-w-none text-xl leading-relaxed italic">
                        <p>Un gouffre sans fin barre la route. Le pont est constitué de dalles <span
                                class="text-red-500">rouges</span> et <span class="text-green-500">vertes</span>.
                            Certaines semblent fragiles (Flaky Tests).</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 choice-container">
                        <button class="choice-btn choice" data-mana="-5" data-xp="+10" data-karma="+10"
                            onclick="applyChoice(this)">
                            <p class="text-lg font-bold">Réparer les dalles rouges avant de traverser.</p>
                        </button>
                        <button class="choice-btn choice" data-mana="+10" data-xp="0" data-karma="-20"
                            onclick="applyChoice(this)">
                            <div class="text-accent text-[10px] uppercase mb-2">Magie Noir</div>
                            <p class="text-lg font-bold">Utiliser le sortilège `@Ignore` et sauter.</p>
                        </button>
                    </div>
                    <div class="magical-divider"></div>
                </div>

                <!-- 4. FORET -->
                <div class="section space-y-8">
                    <div class="flex items-center gap-4">
                        <div
                            class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/30">
                            <span class="text-primary font-heading">IV</span>
                        </div>
                        <h3 class="text-2xl text-primary tracking-widest">LA FORÊT DES SPAGHETTIS</h3>
                    </div>
                    <div class="prose prose-invert prose-amber max-w-none text-xl leading-relaxed italic">
                        <p>Des lianes de code s'entremêlent partout. Des <code>GOTO</code> pendent des arbres comme des
                            serpents venimeux.</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 choice-container">
                        <button class="choice-btn choice" data-mana="-15" data-xp="+15" data-karma="+15"
                            onclick="applyChoice(this)">
                            <p class="text-lg font-bold">Sortir l'épée du Refactoring et tailler un chemin propre.</p>
                        </button>
                        <button class="choice-btn choice" data-mana="-5" data-xp="+5" data-karma="-5"
                            onclick="applyChoice(this)">
                            <p class="text-lg font-bold">Se faufiler en ajoutant une condition `if (true)`.</p>
                        </button>
                    </div>
                    <div class="magical-divider"></div>
                </div>

                <!-- 5. AUBERGE -->
                <div class="section space-y-8">
                    <div class="flex items-center gap-4">
                        <div
                            class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/30">
                            <span class="text-primary font-heading">V</span>
                        </div>
                        <h3 class="text-2xl text-primary tracking-widest">L'AUBERGE STACK OVERFLOW</h3>
                    </div>
                    <div class="prose prose-invert prose-amber max-w-none text-xl leading-relaxed italic">
                        <p>Un refuge lumineux. Des voyageurs s'échangent des solutions copiées-collées. L'aubergiste
                            vous propose un breuvage.</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 choice-container">
                        <button class="choice-btn choice" data-mana="+40" data-xp="0" data-karma="0"
                            onclick="applyChoice(this)">
                            <p class="text-lg font-bold text-center">Boire la Potion de Caféine</p>
                        </button>
                        <button class="choice-btn choice" data-mana="+20" data-xp="+10" data-karma="0"
                            onclick="applyChoice(this)">
                            <p class="text-lg font-bold text-center">Écouter les légendes des anciens</p>
                        </button>
                    </div>
                    <div class="magical-divider"></div>
                </div>

                <!-- 11. DRAGON -->
                <div class="section space-y-12">
                    <div class="flex items-center gap-4">
                        <div
                            class="w-10 h-10 rounded-lg bg-red-500/10 flex items-center justify-center border border-red-500/30">
                            <span class="text-red-500 font-heading">XII</span>
                        </div>
                        <h3 class="text-2xl text-red-500 tracking-widest">LE DRAGON MONOLITHIQUE</h3>
                    </div>
                    <div class="prose prose-invert prose-amber max-w-none text-xl leading-relaxed italic">
                        <p>Il est immense. Ses écailles sont faites de classes Java de 5000 lignes. Il crache du XML
                            brûlant.</p>
                    </div>
                    <div class="grid grid-cols-1 gap-6 choice-container">
                        <button class="choice-btn choice border-primary/40 bg-primary/5" data-mana="-30" data-xp="+30"
                            data-karma="+20" onclick="applyChoice(this)">
                            <div class="text-primary font-bold text-xs uppercase mb-1">Stratégie Royale</div>
                            <p class="text-xl">Attaque "Strangler Fig Pattern"</p>
                        </button>
                        <button class="choice-btn choice border-red-500/40 bg-red-500/5" data-mana="-10" data-xp="+10"
                            data-karma="-20" onclick="applyChoice(this)">
                            <div class="text-red-400 font-bold text-xs uppercase mb-1">Expéditif</div>
                            <p class="text-xl">Attaque "Gros Patch Sale" (Quick Fix)</p>
                        </button>
                        <button class="choice-btn choice border-secondary/40 bg-secondary/5" data-mana="-50" data-xp="0"
                            data-karma="0" onclick="applyChoice(this)">
                            <div class="text-secondary font-bold text-xs uppercase mb-1">Acte de Désespoir</div>
                            <p class="text-xl">Incantation : "REWRITE FROM SCRATCH"</p>
                        </button>
                    </div>
                </div>

                <!-- 12. TRESOR -->
                <div class="section space-y-8">
                    <div class="parchment-card p-12 rounded-sm text-center border-dashed border-4 border-[#d4af37]">
                        <h3 class="text-3xl mb-6 font-bold text-[#2c1810]">LE TRÉSOR DE LA PROD</h3>
                        <p class="text-xl mb-8 leading-relaxed">Le dragon est vaincu. Le coffre de la Production brille.
                            Un seul geste pour livrer la valeur au Royaume.</p>
                        <button
                            class="choice-btn choice !bg-[#2c1810] !text-[#f4e8d0] mx-auto inline-flex px-12 py-6 text-2xl"
                            data-mana="0" data-xp="+5" data-karma="+5" onclick="applyChoice(this); computeEnding(true)">
                            OUVRIR LE COFFRE
                        </button>
                    </div>
                </div>

                <p class="mt-20 text-center text-primary/40 font-heading tracking-[0.5em] text-sm animate-pulse italic">
                    FIN DU MANUSCRIT
                </p>

                <!-- Final Action - Fixed for better UI -->
                <div class="actions mt-16 group">
                    <button
                        class="choice-btn choice w-full p-8 rounded-xl bg-background-dark/50 text-primary font-heading text-3xl border border-primary/30 tracking-[0.3em] shadow-2xl relative overflow-hidden flex items-center justify-center gap-6"
                        id="report-btn" onclick="computeEnding(true)">
                        <div
                            class="absolute inset-0 bg-primary/5 translate-y-full group-hover:translate-y-0 transition-transform duration-500">
                        </div>
                        <span class="material-symbols-outlined text-4xl">history_edu</span>
                        SIGNER LE GRIMOIRE
                    </button>
                </div>
            </div>

            <!-- Right Column: HUD (4/12) -->
            <aside class="lg:col-span-4 lg:sticky lg:top-24 space-y-8">
                <!-- Character Scroll HUD -->
                <div class="bg-[#f4e8d0] text-[#2c1810] border-2 border-[#d4af37] shadow-2xl relative">
                    <!-- Corner Ornaments -->
                    <div class="absolute -top-3 -left-3 w-8 h-8 border-t-4 border-l-4 border-[#d4af37]"></div>
                    <div class="absolute -top-3 -right-3 w-8 h-8 border-t-4 border-r-4 border-[#d4af37]"></div>
                    <div class="absolute -bottom-3 -left-3 w-8 h-8 border-b-4 border-l-4 border-[#d4af37]"></div>
                    <div class="absolute -bottom-3 -right-3 w-8 h-8 border-b-4 border-r-4 border-[#d4af37]"></div>

                    <div class="bg-[#2c1810] text-[#f4e8d0] px-6 py-4 flex items-center gap-3">
                        <span class="material-symbols-outlined">shield_with_heart</span>
                        <h4 class="text-sm tracking-widest font-bold">STATUT DU HÉROS</h4>
                    </div>

                    <div id="hud" class="p-8 space-y-8">
                        <!-- Initial state -->
                        <div class="space-y-4 animate-pulse">
                            <div class="h-10 bg-black/5 rounded"></div>
                            <div class="h-10 bg-black/5 rounded"></div>
                            <div class="h-10 bg-black/5 rounded"></div>
                        </div>
                    </div>

                    <!-- Decorative footer -->
                    <div class="p-4 border-t border-black/5 flex justify-center opacity-40">
                        <span class="material-symbols-outlined text-4xl">ink_pen</span>
                    </div>
                </div>


            </aside>
        </div>
    </main>

    <!-- Footer -->
    <footer class="mt-auto border-t border-primary/10 py-16 bg-background-dark/50">
        <div class="max-w-7xl mx-auto px-4 flex flex-col md:flex-row items-center justify-between gap-8">
            <div class="flex items-center gap-10">
                <a href="../medieval.html"
                    class="flex items-center gap-2 text-sm font-heading hover:text-primary transition-colors tracking-widest leading-none">
                    <span class="material-symbols-outlined text-lg">castle</span>
                    RETOUR AU MENU
                </a>
                <a href="https://github.com/ErwanLT/bragi" target="_blank"
                    class="flex items-center gap-2 text-sm font-heading hover:text-primary transition-colors tracking-widest leading-none">
                    <span class="material-symbols-outlined text-lg">history_edu</span>
                    MANUSCRIT GITHUB
                </a>
            </div>
            <p class="text-[10px] text-primary/40 font-serif uppercase tracking-[0.2em] italic">
                &copy; 2025 COMPAGNIE DES CODEURS ANCESTRAUX.
            </p>
        </div>
    </footer>
</body>

</html>