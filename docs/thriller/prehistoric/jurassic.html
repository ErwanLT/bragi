<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>JURASSIC PARK - ISLA NUBLAR</title>
    <link rel="stylesheet" href="../../style/base.css">
    <link rel="stylesheet" href="../../style/thriller-prehistoric.css">
    <script>
        document.addEventListener('keydown', function (event) {
            if (event.key === 'F12' || event.keyCode === 123 ||
                (event.ctrlKey && event.shiftKey && ['I', 'J', 'C'].includes(event.key)) ||
                (event.metaKey && event.altKey && ['I', 'J', 'C'].includes(event.key))) {
                event.preventDefault();
                window.location.href = "../../magic_word.html";
            }
        });
    </script>
    <script>
        const variables = { sante: 100, munitions: 50, securite: 80 };
        const choices = {};

        function updateDisplay() {
            const hud = document.getElementById('hud');
            if (hud) {
                hud.innerHTML = `
                    <div><span>SANT√â:</span> <span style="color: ${variables.sante < 30 ? '#8b0000' : '#2ecc71'}">${variables.sante}%</span></div>
                    <div><span>MUNITIONS:</span> <span>${variables.munitions}</span></div>
                    <div><span>S√âCURIT√â:</span> <span>${variables.securite}%</span></div>
                `;
            }
        }

        function applyChoice(btn) {
            const section = btn.closest('.section');
            const sections = Array.from(document.querySelectorAll('.section'));
            const index = sections.indexOf(section);

            const s = Number(btn.dataset.sante || 0);
            const m = Number(btn.dataset.munitions || 0);
            const sec = Number(btn.dataset.securite || 0);

            choices[index] = { sante: s, munitions: m, securite: sec };

            section.querySelectorAll('.choice').forEach(b => {
                b.classList.remove('selected');
            });
            btn.classList.add('selected');

            recalculateState();
        }

        function recalculateState() {
            variables.sante = 100;
            variables.munitions = 50;
            variables.securite = 80;

            const sortedIndices = Object.keys(choices).sort((a, b) => Number(a) - Number(b));

            for (const idx of sortedIndices) {
                const choice = choices[idx];
                variables.sante += choice.sante;
                variables.munitions += choice.munitions;
                variables.securite += choice.securite;

                variables.sante = Math.max(0, Math.min(100, variables.sante));
                variables.munitions = Math.max(0, variables.munitions);
                variables.securite = Math.max(0, Math.min(100, variables.securite));
            }

            updateDisplay();
        }

        function computeEnding(forceEnding) {
            let title = 'FIN INCONNUE';
            let text = 'Votre histoire se termine ici...';
            let color = '#ff8c00';

            if (forceEnding === 'hero') {
                title = 'ü¶∏ H√âROS DE NUBLAR';
                text = 'Vous avez sauv√© tout le monde et restaur√© la s√©curit√©. InGen vous propose un poste de directeur de la s√©curit√©. Vous refusez poliment et prenez le premier h√©licopt√®re.';
                color = '#2ecc71';
            } else if (forceEnding === 'escape') {
                title = 'üöÅ √âVACUATION R√âUSSIE';
                text = 'Vous avez surv√©cu et quitt√© l\'√Æle. Les cauchemars de dinosaures vous hanteront, mais vous √™tes vivant. C\'est d√©j√† √ßa.';
                color = '#3498db';
            } else if (forceEnding === 'sacrifice') {
                title = 'üíî SACRIFICE H√âRO√èQUE';
                text = 'Vous avez donn√© votre vie pour sauver les autres. Votre nom sera grav√© sur une plaque comm√©morative... que personne ne verra jamais car l\'√Æle est ferm√©e.';
                color = '#e74c3c';
            } else if (variables.sante <= 0) {
                title = '‚ò†Ô∏è D√âVOR√â';
                text = 'Un Velociraptor vous a eu. Vos derni√®res pens√©es : "Clever girl..."';
                color = '#8b0000';
            } else if (variables.securite <= 10) {
                title = 'ü¶ñ CHAOS TOTAL';
                text = 'Le parc est devenu un enfer. Les dinosaures r√®gnent en ma√Ætres. Vous errez, perdu, attendant l\'in√©vitable.';
                color = '#ff6b6b';
            } else if (variables.munitions <= 0 && variables.sante < 50) {
                title = 'üî´ SANS D√âFENSE';
                text = 'Plus de munitions, bless√©, √©puis√©. Un Dilophosaure vous crache son venin. Game over.';
                color = '#9b59b6';
            } else {
                title = 'üèùÔ∏è SURVIE PR√âCAIRE';
                text = 'Vous survivez... pour l\'instant. Mais combien de temps tiendrez-vous sur cette √Æle maudite ?';
                color = '#f39c12';
            }

            const story = document.getElementById('story');
            const oldEnding = document.getElementById('ending-block');
            if (oldEnding) oldEnding.remove();

            story.insertAdjacentHTML('beforeend', `
                <div id="ending-block" style="margin-top:40px; border-top: 3px solid ${color}; padding-top: 20px; animation: fadeIn 2s;">
                    <h2 style="color:${color}; margin-bottom: 20px; text-align: center;">${title}</h2>
                    <p style="text-align:center; font-size: 1.1em;">${text}</p>
                    <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:15px; margin-top:30px; padding-top:20px; border-top:2px dashed ${color};">
                        <div style="text-align:center">
                            <div style="font-size:0.8rem; color:#666">SANT√â</div>
                            <div style="font-size:1.3rem; color:${variables.sante < 30 ? '#8b0000' : '#2ecc71'}">${variables.sante}%</div>
                        </div>
                        <div style="text-align:center">
                            <div style="font-size:0.8rem; color:#666">MUNITIONS</div>
                            <div style="font-size:1.3rem; color:#ff8c00">${variables.munitions}</div>
                        </div>
                        <div style="text-align:center">
                            <div style="font-size:0.8rem; color:#666">S√âCURIT√â</div>
                            <div style="font-size:1.3rem; color:#2d5016">${variables.securite}%</div>
                        </div>
                    </div>
                    <div style="text-align:center; margin-top:25px;">
                        <a href="jurassic.html" style="color: ${color}; text-decoration: none; border: 2px solid ${color}; padding: 10px 20px; display: inline-block; border-radius: 5px; font-weight: bold;">üîÑ RECOMMENCER</a>
                    </div>
                </div>
            `);

            setTimeout(() => {
                document.getElementById('ending-block').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        window.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.section').forEach(section => {
                section.querySelectorAll('.choice').forEach(btn => {
                    const wrapper = document.createElement('div');
                    wrapper.classList.add('choice-wrapper');

                    const s = Number(btn.dataset.sante || 0);
                    const m = Number(btn.dataset.munitions || 0);
                    const sec = Number(btn.dataset.securite || 0);

                    const effects = [];
                    if (s < 0) effects.push(`Sant√© ${s}%`);
                    if (m < 0) effects.push(`Munitions ${m}`);
                    if (sec < 0) effects.push(`S√©curit√© ${sec}%`);
                    if (s > 0) effects.push(`Sant√© +${s}%`);
                    if (m > 0) effects.push(`Munitions +${m}`);
                    if (sec > 0) effects.push(`S√©curit√© +${sec}%`);

                    wrapper.dataset.info = effects.join(' / ') || '';
                    btn.parentNode.insertBefore(wrapper, btn);
                    wrapper.appendChild(btn);
                });
            });
            updateDisplay();
        });
    </script>
</head>

<body>
    <div id="hud"></div>
    <div class="quest-card">
        <h3>ü¶ñ JURASSIC PARK - ISLA NUBLAR ü¶ï</h3>
        <p style="text-align:center; font-style: italic; color: #2d5016;">¬´ La vie trouve toujours un chemin... ¬ª</p>

        <div id="story">

            <!-- 1. ARRIV√âE -->
            <div class="section">
                <p><strong>Jour 1 - 08h00 - H√©liport</strong></p>
                <p>L'h√©licopt√®re se pose sur Isla Nublar. John Hammond vous accueille avec un sourire. "Bienvenue √†
                    Jurassic Park ! Vous allez adorer √ßa."</p>
                <button class="choice" data-securite="+10" onclick="applyChoice(this)">√âcouter attentivement le briefing
                    s√©curit√©.</button>
                <button class="choice" data-munitions="+10" onclick="applyChoice(this)">V√©rifier discr√®tement votre
                    √©quipement.</button>
            </div>

            <!-- 2. VISITE DU CENTRE -->
            <div class="section">
                <p><strong>09h00 - Centre des visiteurs</strong></p>
                <p>Le Dr. Grant observe les fossiles. Le Dr. Malcolm marmonne quelque chose sur la th√©orie du chaos.</p>
                <button class="choice" data-securite="+5" onclick="applyChoice(this)">Poser des questions sur les
                    protocoles de s√©curit√©.</button>
                <button class="choice" data-sante="+5" onclick="applyChoice(this)">Prendre un caf√© et des
                    provisions.</button>
            </div>

            <!-- 3. PREMIER DINOSAURE -->
            <div class="section">
                <p><strong>10h00 - Enclos des Brachiosaures</strong></p>
                <p>Un Brachiosaure g√©ant broute paisiblement. C'est magnifique... et terrifiant.</p>
                <button class="choice" data-securite="-5" onclick="applyChoice(this)">S'approcher pour une meilleure
                    photo (Imprudent).</button>
                <button class="choice" data-securite="+5" onclick="applyChoice(this)">Rester √† distance de
                    s√©curit√©.</button>
            </div>

            <!-- 4. SALLE DE CONTR√îLE -->
            <div class="section">
                <p><strong>11h00 - Salle de contr√¥le</strong></p>
                <p>Ray Arnold vous montre les syst√®mes. Dennis Nedry tape furieusement sur son clavier, l'air suspect.
                </p>
                <button class="choice" data-securite="+15" onclick="applyChoice(this)">M√©moriser l'emplacement des
                    commandes d'urgence.</button>
                <button class="choice" data-munitions="+5" onclick="applyChoice(this)">Demander o√π sont stock√©es les
                    armes.</button>
            </div>

            <!-- 5. ENCLOS DES RAPTORS -->
            <div class="section">
                <p><strong>12h00 - Enclos des Velociraptors</strong></p>
                <p>Robert Muldoon vous avertit : "Ce sont des tueuses. Ne les sous-estimez jamais."</p>
                <button class="choice" data-securite="+10" onclick="applyChoice(this)">√âcouter attentivement ses
                    conseils de survie.</button>
                <button class="choice" data-securite="-10" data-munitions="+15" onclick="applyChoice(this)">Demander √†
                    tester le fusil tranquillisant.</button>
            </div>

            <!-- 6. LA TEMP√äTE -->
            <div class="section">
                <p><strong>14h00 - Safari en Jeep</strong></p>
                <p>Une temp√™te tropicale approche. Le ciel s'assombrit dangereusement.</p>
                <button class="choice" data-securite="+10" onclick="applyChoice(this)">Sugg√©rer de rentrer
                    imm√©diatement.</button>
                <button class="choice" data-securite="-5" onclick="applyChoice(this)">Continuer le tour (On est venus
                    pour voir des dinos !).</button>
            </div>

            <!-- 7. PANNE DE COURANT -->
            <div class="section">
                <p><strong>15h30 - Panne g√©n√©rale</strong></p>
                <p>Toutes les lumi√®res s'√©teignent. Nedry a d√©sactiv√© les syst√®mes de s√©curit√© !</p>
                <button class="choice" data-securite="-20" data-munitions="+10" onclick="applyChoice(this)">Sortir de la
                    Jeep pour inspecter.</button>
                <button class="choice" data-securite="-10" onclick="applyChoice(this)">Rester dans la Jeep et
                    verrouiller les portes.</button>
            </div>

            <!-- 8. LE T-REX -->
            <div class="section">
                <p><strong>16h00 - Rencontre avec le T-Rex</strong></p>
                <p>Des pas lourds. L'eau dans le verre vibre. Le Tyrannosaurus Rex sort de son enclos.</p>
                <button class="choice" data-sante="-20" data-securite="-15" onclick="applyChoice(this)">Courir vers la
                    jungle !</button>
                <button class="choice" data-sante="-10" onclick="applyChoice(this)">Ne pas bouger. Il voit le
                    mouvement...</button>
            </div>

            <!-- 9. FUITE DANS LA JUNGLE -->
            <div class="section">
                <p><strong>17h00 - Jungle dense</strong></p>
                <p>Vous √™tes perdu dans la jungle. Des cris de dinosaures r√©sonnent partout.</p>
                <button class="choice" data-sante="+10" onclick="applyChoice(this)">Chercher des fruits et de
                    l'eau.</button>
                <button class="choice" data-securite="+10" onclick="applyChoice(this)">Grimper √† un arbre pour rep√©rer
                    le centre.</button>
            </div>

            <!-- 10. DILOPHOSAURE -->
            <div class="section">
                <p><strong>18h00 - Rencontre inattendue</strong></p>
                <p>Un petit Dilophosaure vous observe, la t√™te pench√©e. Il a l'air... mignon ?</p>
                <button class="choice" data-sante="-30" data-munitions="-10" onclick="applyChoice(this)">Lui lancer un
                    b√¢ton (Mauvaise id√©e).</button>
                <button class="choice" data-munitions="-5" onclick="applyChoice(this)">Tirer une fus√©e de d√©tresse pour
                    l'effrayer.</button>
            </div>

            <!-- 11. RETOUR AU CENTRE -->
            <div class="section">
                <p><strong>19h00 - Centre des visiteurs abandonn√©</strong></p>
                <p>Le centre est plong√© dans le noir. Vous entendez des griffes sur le sol.</p>
                <button class="choice" data-securite="+15" onclick="applyChoice(this)">Aller √† la salle de contr√¥le
                    restaurer l'√©lectricit√©.</button>
                <button class="choice" data-munitions="+20" onclick="applyChoice(this)">Fouiller l'armurerie
                    d'abord.</button>
            </div>

            <!-- 12. LES RAPTORS -->
            <div class="section">
                <p><strong>20h00 - Cuisine</strong></p>
                <p>Deux Velociraptors vous traquent. Ils communiquent entre eux. Vous √™tes pris en tenaille.</p>
                <button class="choice" data-sante="-15" data-munitions="-20" onclick="applyChoice(this)">Tirer sur le
                    premier raptor.</button>
                <button class="choice" data-sante="-5" onclick="applyChoice(this)">Se cacher dans le
                    cong√©lateur.</button>
            </div>

            <!-- 13. RESTAURATION DU SYST√àME -->
            <div class="section">
                <p><strong>21h00 - Salle de contr√¥le</strong></p>
                <p>Lex r√©ussit √† red√©marrer le syst√®me. "It's a UNIX system, I know this !"</p>
                <button class="choice" data-securite="+30" onclick="applyChoice(this)">R√©activer toutes les cl√¥tures
                    √©lectriques.</button>
                <button class="choice" data-securite="+20" data-munitions="+10" onclick="applyChoice(this)">Appeler les
                    secours en priorit√©.</button>
            </div>

            <!-- 14. SAUVETAGE -->
            <div class="section">
                <p><strong>22h00 - H√©liport</strong></p>
                <p>Un h√©licopt√®re de secours approche. Mais un T-Rex bloque le chemin !</p>
                <button class="choice" data-sante="-20" data-munitions="-30" onclick="applyChoice(this)">Cr√©er une
                    diversion avec les fus√©es.</button>
                <button class="choice" data-securite="-10" onclick="applyChoice(this)">Attendre qu'il parte
                    (Risqu√©).</button>
            </div>

            <!-- 15. CHOIX FINAL -->
            <div class="section">
                <p><strong>23h00 - Le Choix Final</strong></p>
                <p>Vous √™tes √† l'h√©licopt√®re. Mais vous entendez des cris... Il reste des survivants dans le bunker !
                </p>
                <button class="choice" data-sante="-30" data-securite="-20"
                    onclick="applyChoice(this); computeEnding('hero')">Retourner les sauver (H√©ro√Øque).</button>
                <button class="choice" onclick="applyChoice(this); computeEnding('escape')">Monter dans l'h√©lico et
                    partir (Survie).</button>
                <button class="choice" data-sante="-100" onclick="applyChoice(this); computeEnding('sacrifice')">Rester
                    pour d√©truire le labo (Sacrifice).</button>
            </div>

            <p style="margin-top:40px; text-align: center; color: #ff8c00;"><strong>/// FIN DE LA VISITE ///</strong>
            </p>
            <div class="actions">
                <button class="choice" id="report-btn"
                    style="text-align:center; background-color: #2d5016; color: #ff8c00; border-color: #ff8c00;"
                    onclick="computeEnding()">RAPPORT FINAL</button>
            </div>
        </div>

        <div class="navigation-footer"
            style="margin-top: 3rem; padding-top: 2rem; border-top: 2px dashed #2d5016; text-align: center;">
            <a href="../../thriller.html" style="color: #666; text-decoration: none; margin-right: 1.5rem;">&larr;
                Retour
                aux Thrillers</a>
            <a href="../../index.html" style="color: #666; text-decoration: none;">Menu Principal</a>
        </div>
    </div>
</body>

</html>