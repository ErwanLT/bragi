<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>La plume dont vous Ãªtes le HÃ©ros</title>

    <link rel="stylesheet" href="style/story.css">

    <script>
        // variables globales
        const variables = { stress: 4, prepa: 3, batterie: 7 };
        const choices = {};

        function applyChoice(btn) {
            const section = btn.closest('.section');
            const sections = Array.from(document.querySelectorAll('.section'));
            const index = sections.indexOf(section);

            // Revert previous choice
            if (choices[index]) {
                const prev = choices[index];
                variables.stress -= prev.stress;
                variables.prepa -= prev.prepa;
                variables.batterie -= prev.batterie;
            }

            // Apply new choice
            const s = Number(btn.dataset.stress || 0);
            const p = Number(btn.dataset.prepa || 0);
            const b = Number(btn.dataset.batterie || 0);

            variables.stress += s;
            variables.prepa += p;
            variables.batterie += b;

            choices[index] = { stress: s, prepa: p, batterie: b };

            // Visual update
            section.querySelectorAll('.choice').forEach(b => {
                b.classList.remove('selected');
                // Allow re-selection
            });

            btn.classList.add('selected');

            checkProgress();
        }

        function checkProgress() {
            const sections = document.querySelectorAll('.section');
            const total = sections.length;
            const answered = Object.keys(choices).length;

            const finalBtn = document.getElementById('final-btn');
            if (finalBtn) {
                const isReady = answered === total;
                finalBtn.disabled = !isReady;
                finalBtn.style.opacity = isReady ? "1" : "0.5";
                finalBtn.style.cursor = isReady ? "pointer" : "not-allowed";
                finalBtn.title = isReady ? "" : "RÃ©pondez Ã  toutes les questions pour dÃ©couvrir votre fin.";
            }
        }

        function computeEnding() {
            let title = 'Fin classique';
            let text = 'Tu as terminÃ© ton aventure Ã©ditoriale de maniÃ¨re classique.';

            if (variables.stress >= 7) {
                title = 'ğŸ”¥ Burn-out Ã‰ditorial';
                text = 'Tu as trop poussÃ©, tu repars Ã©puisÃ©Â·e mais avec la lÃ©gende qui va avec.';
            } else if (variables.prepa >= 8) {
                title = 'ğŸ§  Lâ€™Auteur PossÃ©dÃ©';
                text = 'Tu as prÃ©parÃ© Ã  fond et tout est presque parfait. Bravo !';
            } else if (variables.batterie >= 10) {
                title = 'â˜• La Plume Zen';
                text = 'Tu as gÃ©rÃ© ton Ã©nergie et ton rÃ©seau avec brio. InspirÃ©Â·e et lÃ©gerÂ·Ã¨re.';
            }

            const story = document.getElementById('story');

            // Supprimer lâ€™ancienne fin si elle existe
            const oldEnding = document.getElementById('ending-block');
            if (oldEnding) oldEnding.remove();

            // Ajouter la nouvelle fin
            story.insertAdjacentHTML('beforeend', `
                <div id="ending-block" style="margin-top:14px; padding:12px; border-radius:8px; background:#fff; border:1px solid #e6eef7;">
                    <div style="font-weight:700; margin-bottom:6px">RÃ©sultat : ${title}</div>
                    <div>${text}</div>
                    <div style="margin-top:10px;">
                        <span style="display:inline-block; padding:6px 8px; border-radius:6px; font-weight:700; font-size:0.85rem; background:#eef8ff;color:#0b5fa8">Stress: ${variables.stress}</span>
                        <span style="display:inline-block; padding:6px 8px; border-radius:6px; font-weight:700; font-size:0.85rem; background:#fff7ea;color:#a66f00; margin-left:6px">PrÃ©pa: ${variables.prepa}</span>
                        <span style="display:inline-block; padding:6px 8px; border-radius:6px; font-weight:700; font-size:0.85rem; background:#f0fff4;color:#0a7a2e; margin-left:6px">Batterie sociale: ${variables.batterie}</span>
                    </div>
                </div>
            `);

            setTimeout(() => {
                document.getElementById('ending-block').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        // ajouter infobulles dynamiques aprÃ¨s chargement
        window.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.section').forEach(section => {
                section.querySelectorAll('.choice').forEach(btn => {
                    const wrapper = document.createElement('div');
                    wrapper.classList.add('choice-wrapper');

                    const s = Number(btn.dataset.stress || 0);
                    const p = Number(btn.dataset.prepa || 0);
                    const b = Number(btn.dataset.batterie || 0);

                    const effects = [];
                    if (s !== 0) effects.push(`Stress ${s > 0 ? "+" + s : s}`);
                    if (p !== 0) effects.push(`PrÃ©pa ${p > 0 ? "+" + p : p}`);
                    if (b !== 0) effects.push(`Batterie ${b > 0 ? "+" + b : b}`);

                    wrapper.dataset.info = effects.join(' Â· ') || 'Aucun effet';

                    // remplacer le bouton par le wrapper
                    btn.parentNode.insertBefore(wrapper, btn);
                    wrapper.appendChild(btn);
                });
            });
            checkProgress(); // Initialize button state
        });
    </script>
</head>

<body>
    <div class="quest-card">
        <h3>ğŸ–‹ï¸ La plume dont vous Ãªtes le HÃ©ros â€” Quelle sera votre fin Ã©ditoriale ?</h3>

        <div id="story">
            <p>Tu viens de poser ton sac dans le hall dâ€™entrÃ©e du Palais des CongrÃ¨s. Il est 8 h 12. Ton talk est demain
                Ã  14 h 10 en salle RhÃ´ne. Tu as 28 heures 58 minutes avant le jugement dernier.</p>

            <div class="section">
                <p><strong>1. Hall dâ€™entrÃ©e, 8 h 12</strong></p>
                <button class="choice" data-stress="0" data-prepa="1" data-batterie="0"
                    onclick="applyChoice(this)">Foncer direct en salle RhÃ´ne pour tester la dÃ©mo</button>
                <button class="choice" data-stress="0" data-prepa="0" data-batterie="1"
                    onclick="applyChoice(this)">Prendre un cafÃ© + croissant et faire semblant dâ€™Ãªtre sociable</button>
                <button class="choice" data-stress="0" data-prepa="0" data-batterie="2"
                    onclick="applyChoice(this)">Aller poser tes affaires au speaker lounge</button>
            </div>

            <div class="section">
                <p><strong>2. Test technique â€“ salle encore vide</strong></p>
                <button class="choice" data-stress="2" data-prepa="3" data-batterie="0"
                    onclick="applyChoice(this)">Refaire en 4/3</button>
                <button class="choice" data-stress="1" data-prepa="0" data-batterie="0"
                    onclick="applyChoice(this)">Forcer le 16/9 avec des barres noires</button>
            </div>

            <p><strong>â€¦et ainsi de suite pour chaque sectionâ€¦</strong></p>

            <p><strong>DerniÃ¨re Ã©tape â€” DÃ©couvrir ta fin :</strong></p>
            <div class="actions">
                <button class="choice" id="final-btn" onclick="computeEnding()">âœ¨ DÃ©couvrir ma fin</button>
            </div>
        </div>
    </div>
</body>

</html>