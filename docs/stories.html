<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bragi - La Biblioth√®que</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <meta name="description" content="Explorez la biblioth√®que d'histoires interactives de Bragi.">
    <link rel="stylesheet" href="style/index.css">
    <link rel="stylesheet" href="style/genres.css">
    <link rel="stylesheet" href="style/stories.css">
    <!-- Storage Utility -->
    <script src="js/security.js"></script>
    <!-- Preconnect to Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <header>
        <h1>La Biblioth√®que</h1>
        <p class="subtitle">Choisissez votre prochaine aventure parmi nos r√©cits interactifs.</p>
    </header>

    <nav class="filter-bar">
        <button class="filter-btn active" data-filter="all">Tous</button>
        <button class="filter-btn" data-filter="horror">Horreur</button>
        <button class="filter-btn" data-filter="scifi">Science-Fiction</button>
        <button class="filter-btn" data-filter="western">Western</button>
        <button class="filter-btn" data-filter="adventure">Aventure</button>
        <button class="filter-btn" data-filter="fantasy">Fantasy</button>
        <button class="filter-btn" data-filter="polar">Polar</button>
        <button class="filter-btn" data-filter="thriller">Thriller</button>
    </nav>

    <div class="data-mgmt">
        <button id="export-progress" class="data-btn">
            <span class="icon">üíæ</span> Sauvegarder ma progression
        </button>
        <button id="import-progress-trigger" class="data-btn">
            <span class="icon">üì§</span> Charger une sauvegarde
        </button>
        <input type="file" id="import-progress-file" style="display: none;" accept=".brg">
    </div>

    <main class="stories-grid">
        <!-- Horreur -->
        <article class="story-card card-horror" data-genre="horror" id="labyrinth">
            <div class="story-header">
                <span class="story-icon">üíÄ</span>
                <div>
                    <span class="story-genre">Horreur</span>
                    <div class="sub-genre">Cosmic</div>
                </div>
            </div>
            <a href="horror/cosmic/labyrinth.html" class="story-title">Le labyrinthe oubli√©</a>
        </article>

        <article class="story-card card-horror" data-genre="horror" id="manor">
            <div class="story-header">
                <span class="story-icon">üíÄ</span>
                <div>
                    <span class="story-genre">Horreur</span>
                    <div class="sub-genre">Psychologique</div>
                </div>
            </div>
            <a href="horror/psychological/manor.html" class="story-title">Le manoir du silence</a>
        </article>

        <article class="story-card card-horror" data-genre="horror" id="summer_camp">
            <div class="story-header">
                <span class="story-icon">üíÄ</span>
                <div>
                    <span class="story-genre">Horreur</span>
                    <div class="sub-genre">Slasher</div>
                </div>
            </div>
            <a href="horror/slasher/summer_camp.html" class="story-title">Le Camp du Lac Sanglant</a>
        </article>

        <!-- Sci-Fi -->
        <article class="story-card card-scifi" data-genre="scifi" id="signal_zero">
            <div class="story-header">
                <span class="story-icon">üõ∏</span>
                <div>
                    <span class="story-genre">Science-Fiction</span>
                    <div class="sub-genre">Post-apo</div>
                </div>
            </div>
            <a href="science-fiction/post-apocalyptic/signal_zero.html" class="story-title">Signal z√©ro -
                Transmission</a>
        </article>

        <article class="story-card card-scifi" data-genre="scifi" id="kubrick9">
            <div class="story-header">
                <span class="story-icon">üõ∏</span>
                <div>
                    <span class="story-genre">Science-Fiction</span>
                    <div class="sub-genre">Espace</div>
                </div>
            </div>
            <a href="science-fiction/space/kubrick9.html" class="story-title">Kubrick 9 - Station orbitale</a>
        </article>

        <!-- Western -->
        <article class="story-card card-western" data-genre="western" id="duel">
            <div class="story-header">
                <span class="story-icon">ü§†</span>
                <div>
                    <span class="story-genre">Western</span>
                    <div class="sub-genre">Classique</div>
                </div>
            </div>
            <a href="western/classic/duel.html" class="story-title">Le dernier duel</a>
        </article>

        <!-- Aventure -->
        <article class="story-card card-adventure" data-genre="adventure" id="treasure">
            <div class="story-header">
                <span class="story-icon">‚öìÔ∏è</span>
                <div>
                    <span class="story-genre">Aventure</span>
                    <div class="sub-genre">Piraterie</div>
                </div>
            </div>
            <a href="adventure/piracy/treasure.html" class="story-title">Le tr√©sor de l'ile maudite</a>
        </article>

        <!-- Fantasy -->
        <article class="story-card card-fantasy" data-genre="fantasy" id="quest">
            <div class="story-header">
                <span class="story-icon">üêâ</span>
                <div>
                    <span class="story-genre">Fantasy</span>
                    <div class="sub-genre">M√©di√©val</div>
                </div>
            </div>
            <a href="fantasy/medieval/quest.html" class="story-title">La qu√™te du code ancestral</a>
        </article>

        <!-- Polar -->
        <article class="story-card card-polar" data-genre="polar" id="prohibition">
            <div class="story-header">
                <span class="story-icon">üïµÔ∏è‚Äç‚ôÇÔ∏è</span>
                <div>
                    <span class="story-genre">Polar</span>
                    <div class="sub-genre">Noir</div>
                </div>
            </div>
            <a href="polar/noir/prohibition.html" class="story-title">Dossier: ombres de Chicago - 1932</a>
        </article>

        <!-- Thriller -->
        <article class="story-card card-thriller" data-genre="thriller" id="jurassic">
            <div class="story-header">
                <span class="story-icon">ü¶ñ</span>
                <div>
                    <span class="story-genre">Thriller</span>
                    <div class="sub-genre">Pr√©historique</div>
                </div>
            </div>
            <a href="thriller/prehistoric/jurassic.html" class="story-title">JURASSIC PARK - ISLA NUBLAR</a>
        </article>
    </main>

    <footer>
        <p>&copy; 2025 <a href="index.html"
                style="color: var(--text-secondary); text-decoration: none; margin-left: 10px;">Histoires Bragi</a>.
            <a href="stories.html"
                style="color: var(--text-secondary); text-decoration: none; margin-left: 10px;">Histoires</a>
            <a href="about.html" style="color: var(--text-secondary); text-decoration: none; margin-left: 10px;">√Ä
                propos</a>
            <a href="https://github.com/ErwanLT/bragi"
                style="color: var(--text-secondary); text-decoration: none; margin-left: 10px;" target="_blank">Voir sur
                GitHub</a>
        </p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const filters = document.querySelectorAll('.filter-btn');
            const cards = document.querySelectorAll('.story-card');

            // Show progress
            if (window.BragiStorage) {
                cards.forEach(card => {
                    if (BragiStorage.isCompleted(card.id)) {
                        card.classList.add('completed');
                    }
                });
            }

            // Data Management
            const exportBtn = document.getElementById('export-progress');
            const importBtn = document.getElementById('import-progress-trigger');
            const fileInput = document.getElementById('import-progress-file');

            if (exportBtn && window.BragiStorage) {
                exportBtn.addEventListener('click', () => BragiStorage.exportProgress());
            }

            if (importBtn && fileInput) {
                importBtn.addEventListener('click', () => fileInput.click());

                fileInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const content = event.target.result;
                        if (BragiStorage.importProgress(content)) {
                            alert("Progression import√©e avec succ√®s !");
                            window.location.reload();
                        } else {
                            alert("Erreur lors de l'importation. Le fichier est peut-√™tre corrompu.");
                        }
                    };
                    reader.readAsText(file);
                });
            }

            filters.forEach(filter => {
                filter.addEventListener('click', () => {
                    // Update active button
                    filters.forEach(btn => btn.classList.remove('active'));
                    filter.classList.add('active');

                    const category = filter.getAttribute('data-filter');

                    cards.forEach(card => {
                        const cardGenre = card.getAttribute('data-genre');

                        if (category === 'all' || category === cardGenre) {
                            card.classList.remove('hidden');
                            // Small delay for staggered animation feel
                            card.style.animation = 'none';
                            card.offsetHeight; // trigger reflow
                            card.style.animation = null;
                        } else {
                            card.classList.add('hidden');
                        }
                    });
                });
            });
        });
    </script>
</body>

</html>